<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, minimal-ui, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#287ba4">
    <meta name="apple-mobile-web-app-title" content="Picograph">
    <meta name="application-name" content="Picograph">
    <meta name="msapplication-TileColor" content="#287ba4">
    <meta name="theme-color" content="#ffffff">

    <title>Picograph</title>
    <script src="PCG/base.js"></script>
    <script src="PCG/pcg-util.js"></script>
    <script src="PCG/pcg-animation-consts.js"></script>
    <script src="PCG/pcg-dom-util.js"></script>
    <script src="PCG/pcg-canvas2d.js"></script>
    <script src="PCG/pcg-ajax.js"></script>
    <script src="PCG/pcg-checkboxes.js"></script>
    <script src="PCG/pcg-dom.js"></script>
    <script src="PCG/pcg-navigation.js"></script>
    <script src="PCG/pcg-formatters.js"></script>
    <script src="PCG/pcg-graph.js"></script>
    <script src="PCG/pcg-axis.js"></script>
    <script src="PCG/picograph.js"></script>

<!--<script src="build/build.js"></script>-->
    <link href="PCG/styles.css" rel="stylesheet" type="text/css">
</head>
<body>
<!--<h1>level 2</h1>-->
<!--<script>window.location.reload(true)</script>-->
    <div class="graph-holder">
        <div class="title">Followers</div>
        <!-- It is a feature - you can spread different parts of graphic all over the page -->
        <div class="graph"></div>
        <div class="graph-switches"></div>
        <div class="graph-mode-switch">Switch to <span>Night</span> Mode</div>
    </div>


    <div class="graph-holder">
        <div class="title">Interactions</div>
        <div class="graph"></div>
        <div class="graph-switches"></div>
        <div class="graph-mode-switch">Switch to <span>Night</span> Mode</div>
    </div>

    <div class="graph-holder">
        <div class="title">Fruits Exterminated (bln)</div>
        <div class="graph"></div>
        <div class="graph-switches"></div>
        <div class="graph-mode-switch">Switch to <span>Night</span> Mode</div>
    </div>

    <div class="graph-holder">
        <div class="title">Views</div>
        <div class="graph"></div>
        <div class="graph-switches"></div>
        <div class="graph-mode-switch">Switch to <span>Night</span> Mode</div>
    </div>

    <div class="graph-holder">
        <div class="title">No More Pears</div>
        <div class="graph"></div>
        <div class="graph-switches"></div>
        <div class="graph-mode-switch">Switch to <span>Night</span> Mode</div>
    </div>
    <div style="clear:both"></div>
    <div class="credit"><a href="https://github.com/Zibx">Zibx</a>, April 2019</div>


    <!-- load hardcoded test data -->
    <script src="data.js"></script>

    <script>
        /*
        PG - picograph. Init it with a config object
            frame - {from: timestamp, to: timestamp} || {to: null, from: -deltaTime}
            renderTo - specify all 3 elements to render parts of picograph:
                graph div,
                navigation div
                switches div

        You can restyle everything with css
         */
        var graphs = document.querySelectorAll('.graph'),
            switches = document.querySelectorAll('.graph-switches'),
            titles = document.querySelectorAll('.title');




        /*
        CUSTOM ZOOM (load today, a day ago and a week ago)
         */
        var customZoom = function(date) {
            var dates = [date, new Date(date-PCG.DAY), new Date(date-PCG.DAY*7)],
                names = dates.map(PCG.dateFormatter),
                datas = [null, null, null],
                colors = [
                    '#558DED',
                    '#64ADED',
                    '#5CBCDF'
                ],

                _self = this;
            dates.forEach(function(date, i) {
                var fileName = PCG.path.join(
                    [date.getFullYear(), PCG.pad(date.getMonth()+1)].join('-'),
                    [PCG.pad(date.getDate()), 'json'].join('.')
                );
                _self.loadData( fileName, true, function(err, data) {
                    if(err){
                        datas[ i ] = false;
                    }else{
                        datas[i] = data;
                    }
                    if(datas[0] !== null && datas[1] !== null && datas[2] !== null){
                        _self.joinAndLoadData( datas, dates, names, colors );
                    }
                } );
            });
        };

        /*
        END CUSTOM ZOOM LOGIC
         */




        var PCGs = [];
        for(var i = 0; i < 5; i++){
            (function(i) {
                var cfg = {
                    dataSource: 'contest/'+(i+1),
                    renderTo: {
                        graph: graphs[i],
                        switches: switches[i],
                        title: titles[i]
                    },
                    frame: {
                        from: -1000 * 60 * 60 * 24 * 30*2, // two month ago
                        to: null
                    },
                    zoomType: i === 4?PCG.ZOOM.INTERPOLATE: i === 3?PCG.ZOOM.CUSTOM:PCG.ZOOM.LOAD
                };
                if(cfg.zoomType === PCG.ZOOM.CUSTOM){
                    cfg.customZoom = customZoom
                }
                var graph = new PCG( cfg );

                PCGs.push(graph);

                window.addEventListener( 'resize', graph.resize );
            })(i);


        }


        [].slice.call(document.querySelectorAll('.graph-mode-switch')).forEach(function(el, i) {
            el.addEventListener('click', function(e) {
                this.parentNode.classList.toggle('night');
                var span = this.querySelector('span');

                span.innerText = PCGs[i].day?'Day':'Night';
                PCGs[i].setNightMode(PCGs[i].day);
                e.preventDefault();
            });
        });


    </script>
</body>
</html>